<!DOCTYPE html>
<html lang='en'>
<head>
    <meta charset='UTF-8'>
    <meta name='viewport' content='width=device-width, initial-scale=1.0'>
    <title>Wake on LAN</title>
    <link rel='stylesheet' href='https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css'>
    <link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css'>
    <script src='https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js'></script>
    <script src='https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js'></script>
    <script>
        $(document).ready(function() {
            updatePCList();
        });
        function updatePCList() {
            fetch('/pc_list').then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();
            }).then(data => {
                if (!Array.isArray(data)) {
                    console.error('Expected an array but got:', data);
                    return;
                }
                const pcList = document.getElementById('pc-list');
                pcList.innerHTML = '';
                data.forEach((pc, index) => {
                    pcList.innerHTML += '<li class="list-group-item d-flex justify-content-between align-items-center">' +
                        pc.name + ' - ' pc.mac + ' - ' pc.ip +
                        '<div class="ml-auto">' +
                        '<button class="btn btn-warning btn-md mr-2" onclick="editPC(' + index + ')"><i class="fas fa-edit"></i></button>' +
                        '<button class="btn btn-primary btn-md" onclick="wakePC(' + pc.mac + ')"><i class="fas fa-play"></i></button>' +
                        '</div></li>';
                });
            }).catch(error => {
                console.error('Fetch error:', error);
            });
        }
        function addPC() {
            const name = document.getElementById('pc-name').value;
            const mac = document.getElementById('pc-mac').value;
            const ip = document.getElementById('pc-ip').value;
            fetch('/add', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ name, mac, ip })
            }).then(response => {
                if (response.ok) {
                    updatePCList();
                    $('#add-pc-modal').modal('hide');
                    document.getElementById('pc-name').value = '';
                    document.getElementById('pc-mac').value = '';
                    document.getElementById('pc-ip').value = '';
                    showNotification('PC added successfully!', 'success');
                }
            });
        }
        function editPC(index) {
            fetch('/pc_list').then(response => response.json()).then(data => {
                const pc = data[index];
                document.getElementById('edit-pc-name').value = pc.name;
                document.getElementById('edit-pc-mac').value = pc.mac;
                document.getElementById('edit-pc-ip').value = pc.ip;
                $('#edit-pc-modal').data('index', index).modal('show');
            });
        }
        function saveEditPC() {
            const index = $('#edit-pc-modal').data('index');
            const name = document.getElementById('edit-pc-name').value;
            const mac = document.getElementById('edit-pc-mac').value;
            const ip = document.getElementById('edit-pc-ip').value;
            fetch('/edit', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ index, name, mac, ip })
            }).then(response => {
                if (response.ok) {
                    updatePCList();
                    $('#edit-pc-modal').modal('hide');
                    showNotification('PC updated successfully!', 'success');
                }
            });
        }
        function confirmDelete() {
            const index = $('#edit-pc-modal').data('index');
            fetch('/delete?index=' + index, { method: 'POST' }).then(response => {
                if (response.ok) {
                    updatePCList();
                    showNotification('PC deleted successfully!', 'danger');
                }
            });
            $('#edit-pc-modal').modal('hide');
        }
        function wakePC(mac) {
            fetch('/wake', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ mac })
            }).then(response => {
                if (response.ok) {
                    showNotification('WOL packet sent to ' + mac, 'info');
                }
            });
        }
        function showNotification(message, type) {
            const notification = $('<div class="alert alert-' + type + 'alert-dismissible fade show" role="alert">' + message + '<button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button></div>');
            $('#notification-area').append(notification);
            setTimeout(() => {
                notification.alert('close');
            }, 3000);
        }
        function resetWiFiSettings() {
            fetch('/reset_wifi', { method: 'POST' })
               .then(response => {
                    if (response.ok) {
                        showNotification('WiFi settings reset successfully!', 'success');
                        location.reload();
                    } else {
                        console.error('Failed to reset WiFi settings');
                        showNotification('Failed to reset WiFi settings.', 'danger');
                    }
                })
               .catch(error => console.error('Fetch error:', error));
        }
        function updateNetworkSettings() {
            const staticIp = document.getElementById('static-ip').value;
            const staticGateway = document.getElementById('static-gateway').value;

            fetch('/update_settings', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ staticIp, staticGateway })
            })
            .then(response => response.json())
            .then(data => {
                    if (data.success) {
                        showNotification('Settings updated successfully!', 'success');
                    } else {
                        showNotification('Failed to update settings.', 'danger');
                    }
                })
            .catch(error => console.error('Fetch error:', error));
        }

        function updateAuthentication() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;

            fetch('/update_authentication', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ username, password })
            })
            .then(response => response.json())
            .then(data => {
                    if (data.success) {
                        showNotification('Authentication updated successfully!', 'success');
                    } else {
                        showNotification('Failed to update authentication.', 'danger');
                    }
                })
            .catch(error => console.error('Fetch error:', error));
        }
    </script>
</head>
<body class='bg-light text-dark'>
    <div class='container mt-5'>
        <h1 class='text-center'>Wake on LAN</h1>
        <div id='notification-area'></div>
        <h2 class='mt-4 d-flex justify-content-between align-items-center'>
            <span>PC List</span>
            <div class='ml-auto'>
                <button class='btn btn-success' data-toggle='modal' data-target='#add-pc-modal'>
                    <i class='fas fa-plus'></i>
                </button>
                <button class='btn btn-secondary btn-md' title='Settings' data-toggle='modal' data-target='#settings-modal'>
                    <i class='fas fa-cog'></i>
                </button>
            </div>
        </h2>
        <ul id='pc-list' class='list-group mt-3'></ul>
    </div>
    <div class='modal fade' id='add-pc-modal' tabindex='-1' role='dialog' aria-labelledby='addPCLabel' aria-hidden='true'>
        <div class='modal-dialog' role='document'>
            <div class='modal-content'>
                <div class='modal-header'>
                    <h5 class='modal-title' id='addPCLabel'>Add PC</h5>
                    <button type='button' class='close' data-dismiss='modal' aria-label='Close'>
                        <span aria-hidden='true'>&times;</span>
                    </button>
                </div>
                <div class='modal-body'>
                    <div class='form-group'>
                        <label for='pc-name'>Name</label>
                        <input type='text' class='form-control' id='pc-name' placeholder='Enter PC name'>
                    </div>
                    <div class='form-group'>
                        <label for='pc-mac'>MAC Address</label>
                        <input type='text' class='form-control' id='pc-mac' placeholder='Enter MAC address'>
                    </div>
                    <div class='form-group'>
                        <label for='pc-ip'>IP Address</label>
                        <input type='text' class='form-control' id='pc-ip' placeholder='Enter IP address'>
                    </div>
                </div>
                <div class='modal-footer'>
                    <button type='button' class='btn btn-primary' onclick='addPC()'>Add</button>
                    <button type='button' class='btn btn-secondary' data-dismiss='modal'>Close</button>
                </div>
            </div>
        </div>
    </div>
    <div class='modal fade' id='edit-pc-modal' tabindex='-1' role='dialog' aria-labelledby='editPCLabel' aria-hidden='true'>
        <div class='modal-dialog' role='document'>
            <div class='modal-content'>
                <div class='modal-header'>
                    <h5 class='modal-title' id='editPCLabel'>Edit PC</h5>
                    <button type='button' class='close' data-dismiss='modal' aria-label='Close'>
                        <span aria-hidden='true'>&times;</span>
                    </button>
                </div>
                <div class='modal-body'>
                    <div class='form-group'>
                        <label for='edit-pc-name'>Name</label>
                        <input type='text' class='form-control' id='edit-pc-name' placeholder='Enter PC name'>
                    </div>
                    <div class='form-group'>
                        <label for='edit-pc-mac'>MAC Address</label>
                        <input type='text' class='form-control' id='edit-pc-mac' placeholder='Enter MAC address'>
                    </div>
                    <div class='form-group'>
                        <label for='edit-pc-ip'>IP Address</label>
                        <input type='text' class='form-control' id='edit-pc-ip' placeholder='Enter IP address'>
                    </div>
                </div>
                <div class='modal-footer'>
                    <button type='button' class='btn btn-primary' onclick='saveEditPC()'>Save changes</button>
                    <button type='button' class='btn btn-danger' onclick='confirmDelete()'>Delete</button>
                    <button type='button' class='btn btn-secondary' data-dismiss='modal'>Close</button>
                </div>
            </div>
        </div>
    </div>
    <div class='modal fade' id='settings-modal' tabindex='-1' role='dialog' aria-labelledby='settingsLabel' aria-hidden='true'>
        <div class='modal-dialog' role='document'>
            <div class='modal-content'>
                <div class='modal-header'>
                    <h5 class='modal-title' id='settingsLabel'>Settings</h5>
                    <button type='button' class='close' data-dismiss='modal' aria-label='Close'>
                        <span aria-hidden='true'>&times;</span>
                    </button>
                </div>
                <div class='modal-body'>
                    <div class='card'>
                        <div class='card-header'>
                            <h5 class='modal-title'>Network</h5>
                        </div>
                        <div class='card-body'>
                            <div class='form-group'>
                                <label for='static-ip'>Static IP:</label>
                                <input type='text' class='form-control' id='static-ip' placeholder='Enter Static IP address'>
                            </div>
                            <div class='form-group'>
                                <label for='static-gateway'>Static Gateway:</label>
                                <input type='text' class='form-control' id='static-gateway' placeholder='Enter Gateway IP address'>
                            </div>
                        </div>
                        <div class='card-footer'>
                            <button type='button' class='btn btn-primary' onclick='updateNetworkSettings()'>Update</button>
                            <button type='button' class='btn btn-danger' title='Reset WiFi' data-toggle='modal' data-target='#reset-wifi-modal'>Reset WiFi</button>
                        </div>
                    </div>
                    <hr/>
                    <div class='card'>
                        <div class='card-header'>
                            <h5 class='modal-title'>Authentication</h5>
                        </div>
                        <div class='card-body'>
                            <div class='form-group'>
                                <label for='username'>Username:</label>
                                <input type='text' class='form-control' id='username' placeholder='Enter username'>
                            </div>
                            <div class='form-group'>
                                <label for='password'>Password:</label>
                                <input type='password' class='form-control' id='password' placeholder='Enter password'>
                            </div>
                        </div>
                        <div class='card-footer'>
                            <button type='button' class='btn btn-primary' onclick='updateAuthentication()'>Update</button>
                        </div>
                    </div>
                </div>
                <div class='modal-footer'>
                    <button type='button' class='btn btn-secondary' data-dismiss='modal'>Close</button>
                </div>
            </div>
        </div>
    </div>
    <div class='modal fade' id='reset-wifi-modal' tabindex='-1' role='dialog' aria-labelledby='resetWiFiLabel' aria-hidden='true'>
        <div class='modal-dialog' role='document'>
            <div class='modal-content'>
                <div class='modal-header'>
                    <h5 class='modal-title' id='resetWiFiLabel'>Reset WiFi Settings</h5>
                    <button type='button' class='close' data-dismiss='modal' aria-label='Close'>
                        <span aria-hidden='true'>&times;</span>
                    </button>
                </div>
                <div class='modal-body'>
                    <p>Are you sure you want to reset WiFi settings? This will clear saved credentials.</p>
                </div>
                <div class='modal-footer'>
                    <button type='button' class='btn btn-danger' onclick='resetWiFiSettings()'>Reset</button>
                    <button type='button' class='btn btn-secondary' data-dismiss='modal'>Cancel</button>
                </div>
            </div>
        </div>
    </div>
    <footer class='text-center mt-5'>
        <p>&copy; 2025 StafLoker</p>
    </footer>
</body>
</html>